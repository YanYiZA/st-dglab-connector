# DG-Lab Connector for SillyTavern

这是一个 **SillyTavern** 的扩展插件，允许 AI 角色通过文本指令控制 **DG-Lab 郊狼** 电击设备。

---

## 🔌 工作原理

插件通过监听 SillyTavern 的消息接收事件，实时分析 AI 输出的内容。当检测到特定的控制标签（如 `[DG:50]`）时，插件会通过本地运行的 DG-Lab Hub API 向指定的设备发送强度指令。

### 核心流程
1.  **消息监听**：插件挂载到 SillyTavern 的 `MESSAGE_RECEIVED` 事件。
2.  **指令解析**：使用正则表达式扫描消息内容，提取 `[DG:强度]` 或 `[DG:强度:持续时间]` 格式的标签。
3.  **强度计算**：按百分比映射
4.  **指令发送**：通过 HTTP POST 请求将计算后的强度值发送到 DG-Lab Hub API (默认 `http://127.0.0.1:8920`)。
5.  **队列处理**：如果一条消息中包含多个指令，插件会按顺序依次执行。

---

## 🛠️ 使用方法

### 1. 环境准备
- 确保已安装并运行 **DG-Lab Hub** (或其他兼容的 WebSocket/HTTP 桥接服务)。
- 确保 **DG-Lab 设备** 已连接到 Hub。
- 安装并启用Chrome插件 Moesif Origin/CORS Changer & API Logger 以解决CORS问题

### 2. 插件设置
在 SillyTavern 的扩展设置面板中找到 **DG-Lab Connector**：
- **启用插件**：开启或关闭功能。
- **Hub API URL**：DG-Lab Hub 的地址，默认为 `http://127.0.0.1:8920`。
- **Target ID**：目标设备的 ID（通常为 `1` 或 `2`，取决于连接顺序）。
- **Max Strength (100%)**：**[重要]** 设定 100% 对应的实际物理强度值。建议初次使用时设低一些（如 10-20），以策安全。

### 3. AI 指令格式
在角色的回复或世界书/Prompt 中使用以下格式：

| 格式 | 描述 | 示例 |
| :--- | :--- | :--- |
| `[DG:50]` | 以 50% 的强度电击，默认持续 5 秒 | `[DG:50]` |
| `[DG:100:2]` | 以 100% 的强度电击，持续 2 秒 | `[DG:100:2]` |
| `[DG:0]` | 停止电击 | `[DG:0]` |

### 4. 示例
如果你的最大强度设置为 **20**：
- AI 回复：“受到惩罚吧！[DG:80]”
- -> 设备将收到强度 **16** 的指令 (20 * 0.8)。

---

## ⚠️ 免责声明
本插件仅供娱乐和学习使用。请务必在安全范围内使用电击设备，并对自己的身体承受能力有充分认知。开发者不对因使用本插件造成的任何身体伤害或设备损坏负责。
